#!/bin/bash

# ------------------------------------------------------------------------------
#
# .bash_preinit
#
# Sets the environment variables based on the uname.
#
# ------------------------------------------------------------------------------

KERNEL=$(uname)
EMACS=
EMACS_CLIENT=
PATH="$HOME/Scripts:$HOME/bin:$PATH"

# Set environment based on the kernel.
#
if [ "$KERNEL" == "Linux" ]; then

  # Alias tmux to use Ubuntu config file
  #
  alias tmux='tmux -f ~/.ubu.tmux.conf'

  # Environment variables
  #
  EMACS=/usr/bin/emacs
  EMACS_CLIENT=/usr/bin/emacsclient

  cmdnotify()
  {
    CMD=$1
    shift
 
    $CMD $@
    RETCODE=$?
    CUR_DIR=${PWD##*/}
    CUR_CMD=`basename $CMD`
    if [ $RETCODE -eq 0 ]
    then
      notify-send -c $CUR_CMD -i emblem-default -t 3600000 "$CUR_DIR: $CUR_CMD successful" "$(date)"
    else
      notify-send -c $CUR_CMD -i emblem-important -t 3600000 "$CUR_DIR: $CUR_CMD failed" "$(date)"
    fi
    return $RETCODE
  }
elif [ "$KERNEL" == "Darwin" ]; then

  # Alias tmux to use Ubuntu config file
  #
  alias tmux='tmux -f ~/.osx.tmux.conf'

  if [ -f ~/Scripts/MacOSX_functions ]; then
    . ~/Scripts/MacOSX_functions
  fi

  # Environment variables
  #
  EMACS=/Applications/Emacs.app/Contents/MacOS/Emacs
  EMACS_CLIENT=/Applications/Emacs.app/Contents/MacOS/bin/emacsclient
  
  # Makes the directories show up in cyan
  export LSCOLORS=gxfxcxdxbxegedabagacad
  
  cmdstatus()
  {
    CMD=$1
    shift
    
    $CMD $@
    RETCODE=$?
    CUR_DIR=${PWD##*/}
    CUR_CMD=`basename $CMD`
    if [ $RETCODE -eq 0 ]
    then
      printf '\a'
      growlnotify -s -d $CUR_CMD -n $CUR_CMD -m "$CUR_DIR: $CUR_CMD successful $(date)"
    else
      printf '\a\a'
      growlnotify -s -d $CUR_CMD -n $CUR_CMD -m "$CUR_DIR: $CUR_CMD failed $(date)"
    fi
    return $RETCODE
  }  
fi

export EMACS
export EMACS_CLIENT
